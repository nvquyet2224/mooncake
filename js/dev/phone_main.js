var timerOtp,otpCountValue=60,currentPhone="",clientId="";const trackingId="UA-41845604-27";function countOtp(){timerOtp=setInterval((function(){if(otpCountValue>=0){var e=otpCountValue<10?"0"+otpCountValue:otpCountValue;document.querySelector(".time__count").innerHTML=e}--otpCountValue<0&&clearInterval(timerOtp)}),1e3)}function validText(e){var o=!0;return""===$(e).val()&&(o=!1),o}function getSelectData(e){var o=!1;return""!=$(e).val()&&(o=$(e).val()),o}function numberInput(e){$(e).val($(e).val().replace(/[^0-9]/g,""))}function validEmail(e){var o=$(e).val();return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(o)}function loginValid(){var e=validText("#txt_phone"),o=/(3|5|7|8|9|1[2|6|8|9])+([0-9]{8})\b/,t=$("#txt_phone").val(),a=!!$("#chk_condition").is(":checked");1==o.test(t)?$("#verify-otp").hasClass("show__error")&&$("#verify-otp").removeClass("show__error"):$("#verify-otp").hasClass("show__error")||$("#verify-otp").addClass("show__error"),e&&a&&1==o.test(t)?$("#loginSubmit").attr("disabled",!1):$("#loginSubmit").attr("disabled",!0)}function otpValid(){var e=!0;return""!==$("#otp1").val()&&""!==$("#otp2").val()&&""!==$("#otp3").val()&&""!==$("#otp4").val()||(e=!1),e}function infoValid(){var e=validText("#txt_username"),o=validText("#txt_email"),t=validEmail("#txt_email"),a=validText("#slDay .select__input"),n=validText("#slMonth .select__input"),i=validText("#slYear .select__input");e&&o&&a&&n&&i&&t?($("#infoSubmit").attr("disabled",!1),$("#verify-username").hasClass("show__error")&&$("#verify-username").removeClass("show__error"),$("#verify-email").hasClass("show__error")&&$("#verify-email").removeClass("show__error"),$("#verify-email").hasClass("show__error")&&$("#verify-email").removeClass("show__error"),$("#verify-dob").hasClass("show__error")&&$("#verify-dob").removeClass("show__error")):($("#infoSubmit").attr("disabled",!0),e?$("#verify-username").hasClass("show__error")&&$("#verify-username").removeClass("show__error"):$("#verify-username").hasClass("show__error")||$("#verify-username").addClass("show__error"),o?$("#verify-email").hasClass("show__error")&&$("#verify-email").removeClass("show__error"):$("#verify-email").hasClass("show__error")||$("#verify-email").addClass("show__error"),t?$("#verify-email").hasClass("show__error")&&$("#verify-email").removeClass("show__error"):$("#verify-email").hasClass("show__error")||$("#verify-email").addClass("show__error"),a&&n&&i?$("#verify-dob").hasClass("show__error")&&$("#verify-dob").removeClass("show__error"):$("#verify-dob").hasClass("show__error")||$("#verify-dob").addClass("show__error"))}function createDay(){for(var e=[],o=1;o<32;o++)e.push({id:o,name:o});return e}function createMonth(){for(var e=[],o=1;o<13;o++)e.push({id:o,name:o});return e}function createYear(){for(var e=[],o=(new Date).getFullYear()-18;o>1940;o--)e.push({id:o,name:o});return e}function getGoogleAnalyticId(){console.log("trackingId",trackingId),"undefined"!=typeof ga&&null!=ga&&null!=ga&&ga((function(){var e=ga.getAll();if(null!=e&&null!=e&&e.length>0)for(i=0;i<e.length;i+=1)e[i].get("trackingId")==trackingId&&(clientId=e[i].get("clientId"),console.log("trackers[i]",e[i]),console.log("clientId",clientId))}))}function InjectingCRMDataIntoGoogleAnalytics(e){if(console.log("InjectingCRMDataIntoGoogleAnalytics - hubspotId",e),null!=e&&null!=e&&(""!=clientId&&null!=clientId&&null!=clientId||getGoogleAnalyticId(),null!=clientId&&null!=clientId&&""!=clientId)){var o={url:"https://www.google-analytics.com/collect?v=1&t=event&tid=UA-41845604-27&cid="+clientId+"&ec=measurement+protocol&ea=crm+data+injection&el=lead-updated&cd3="+e,method:"GET",timeout:0};console.log("InjectingCRMDataIntoGoogleAnalytics - settings",o),$.ajax(o).done((function(e){console.log("InjectingCRMDataIntoGoogleAnalytics done",e)})).fail((function(e){console.log("InjectingCRMDataIntoGoogleAnalytics fail",e)}))}}function getCookie(e){for(var o=e+"=",t=document.cookie.split(";"),a=0;a<t.length;a++){for(var n=t[a];" "==n.charAt(0);)n=n.substring(1,n.length);if(0==n.indexOf(o))return n.substring(o.length,n.length)}return null}function sendData(e){$("#infoSubmit").on("click",(function(){$(".loading__box").hasClass("active")||$(".loading__box").addClass("active"),""!=clientId&&null!=clientId&&null!=clientId||getGoogleAnalyticId();var o=getCookie("hubspotutk"),t=window.location.hostname+window.location.pathname,a=$("#txt_phone").val(),n=$("#txt_username").val(),i=$("#txt_email").val(),l=!!$("#chk_condition").is(":checked"),s=!!$("#chk_promotion").is(":checked"),r="",c=getSelectData("#slDay .select__input"),u=getSelectData("#slMonth .select__input"),d=getSelectData("#slYear .select__input");c&&u&&d&&(r=c+"/"+u+"/"+d),$.ajax({url:"/submit",type:"POST",data:{name:n,dob:r,email:i,phone:a,cid:clientId,terms_and_conditions:l,privacy_policy_opt_in:!1,marketing_consent:s,hutkId:o,pageUri:t,pageName:"Home",subscriptionTypeId:12124569,subscriptionText:"I agree to receive other communications from MDLZ",utmstring:window.location.search},success:function(o){console.log(o);var t=o.data;if(t.synced_hubspot_id&&InjectingCRMDataIntoGoogleAnalytics(t.synced_hubspot_id),o.topup){var a=o.topup;1==a.success?(a.code&&$(".compare__value").html(`${a.code}`),e.openPopup("#giftWin"),$(".loading__box").hasClass("active")&&$(".loading__box").removeClass("active")):(a.code&&$(".compare__value").html(`${a.code}`),e.openPopup("#giftLost"),$(".loading__box").hasClass("active")&&$(".loading__box").removeClass("active"))}else console.log("Không có kết quả topup"),$(".loading__box").hasClass("active")&&$(".loading__box").removeClass("active")},error:function(e){$(".loading__box").hasClass("active")&&$(".loading__box").removeClass("active"),e=JSON.parse(e.responseText),console.log("submit error",e);var o=e.data;o.synced_hubspot_id&&InjectingCRMDataIntoGoogleAnalytics(o.synced_hubspot_id)}})}))}function sendOTP(e,o){if(e){otpCountValue=60,countOtp(),$(".loading__box").hasClass("active")||$(".loading__box").addClass("active");var t={url:"/get-otp?phone="+e+"&utmstring="+window.location.search,method:"GET",timeout:0,headers:{"Content-Type":"application/json"}};$.ajax(t).done((function(o){$(".loading__box").hasClass("active")&&$(".loading__box").removeClass("active"),$(".your-phone").html("+84 "+e),$(".form-item__phone").removeClass("active"),$(".form-item__otp").addClass("active")})).fail((function(e){console.log("sendOTP fail",e),e=JSON.parse(e.responseText),$("#popupNoSendOTP .popup-detail").html(`<p>${e.message}</p>`),o.openPopup("#popupNoSendOTP"),$(".loading__box").hasClass("active")&&$(".loading__box").removeClass("active")}))}else console.log("No phone to send otp"),o.openPopup("#popupNoSendOTP"),$(".loading__box").hasClass("active")&&$(".loading__box").removeClass("active")}!function(){const e=Lib.modules,o=new e.Common,t=new e.Select;o.init(),o.onScroll=function(){console.log("scroll open")},t.init(),t.onSelected=function(){this.parentId,this.valueSelected,infoValid()},$(".select__input").focusout((function(){infoValid()}));const a=createDay(),n=createMonth(),i=createYear();t.setItemsFor("slDay",a,["id","name"]),t.setItemsFor("slMonth",n,["id","name"]),t.setItemsFor("slYear",i,["id","name"]),$("#chk_condition, #chk_promotion").change((function(){loginValid()})),$("#txt_phone").focus((function(e){$(this).parent().removeClass("show__error")})).focusout((function(e){loginValid()})),$(document).on("input",".otp__list input",(function(){if(numberInput(this),$(this).val().length==this.maxLength&&$(this).next("input").focus(),otpValid()){$(".otp__error").html(),$(".loading__box").hasClass("active")||$(".loading__box").addClass("active");var e="/verify-otp?utmstring="+window.location.search;$.ajax({url:e,type:"POST",data:{phone:currentPhone,otp:$("#otp1").val()+$("#otp2").val()+$("#otp3").val()+$("#otp4").val()},global:!1,success:function(e){if(console.log("verifyOTP done",e),e.data){var o=e.data;o.is_logged?o.url&&window.location.replace(o.url):($(".form-item__otp").removeClass("active"),$(".form-item__info").addClass("active"),$(".loading__box").hasClass("active")&&$(".loading__box").removeClass("active"))}},error:function(e){console.log("verifyOTP fail",e),$(".otp__error").html('<p>Mã không hợp lệ - <span class="reset__otp">Nhập lại</span></p>'),$(".loading__box").hasClass("active")&&$(".loading__box").removeClass("active")}})}})),$(document).on("click","#loginSubmit",(function(){sendOTP(currentPhone=$("#txt_phone").val().replace("+",""),o)})),$("#txt_username, #txt_email").focus((function(e){$(this).parent().removeClass("show__error")})).focusout((function(e){infoValid()})),$(document).on("click",".show__condition",(function(){o.openPopup(".popup__condition")})),$(document).on("click",".popup-close",(function(){o.closePopup()})),$(document).on("click",".otp__request",(function(){sendOTP(currentPhone=$("#txt_phone").val().replace("+",""),o)})),$(document).on("click",".reset__otp",(function(){$("#otp1").val(""),$("#otp2").val(""),$("#otp3").val(""),$("#otp4").val(""),$("#otp1").focus()})),sendData(o)}();